<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Project-TMS</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/themes.css">
</head>
<body class="theme-light">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 py-4 px-6">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-purple-400">Project-TMS</h1>
            <nav class="flex space-x-4">
                <a href="index.html" class="text-gray-300 hover:text-white">Dashboard</a>
                <a href="analytics.html" class="text-white">Analytics</a>
                <a href="settings.html" class="text-gray-300 hover:text-white">Settings</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto py-6 px-4">
        <!-- Analytics Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Projects</h3>
                <p class="text-2xl font-bold mt-2" id="totalProjects">0</p>
                <p class="text-sm text-green-500 mt-1" id="projectChange">+0% from last month</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Active Tasks</h3>
                <p class="text-2xl font-bold mt-2" id="activeTasks">0</p>
                <p class="text-sm text-red-500 mt-1" id="taskChange">+0% from last month</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Completion Rate</h3>
                <p class="text-2xl font-bold mt-2" id="completionRate">0%</p>
                <p class="text-sm text-green-500 mt-1" id="rateChange">+0% from last month</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Team Members</h3>
                <p class="text-2xl font-bold mt-2" id="teamMembers">0</p>
                <p class="text-sm text-green-500 mt-1" id="memberChange">+0 from last month</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Project Progress Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Project Progress</h3>
                <canvas id="projectProgressChart"></canvas>
            </div>

            <!-- Task Distribution Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Task Distribution</h3>
                <canvas id="taskDistributionChart"></canvas>
            </div>
        </div>

        <!-- Team Performance -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">Team Performance</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b border-gray-200 dark:border-gray-700">
                            <th class="text-left py-3 px-4">Team Member</th>
                            <th class="text-left py-3 px-4">Tasks Completed</th>
                            <th class="text-left py-3 px-4">On Time</th>
                            <th class="text-left py-3 px-4">Quality Score</th>
                        </tr>
                    </thead>
                    <tbody id="teamPerformanceBody">
                        <!-- Team performance data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Theme Manager Script -->
    <script src="js/themeManager.js"></script>
    <script>
        // Initialize analytics when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            const projects = JSON.parse(localStorage.getItem('projects') || '[]');
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            
            // Calculate analytics
            const totalProjects = projects.length;
            const activeTasks = tasks.filter(task => task.status !== 'done').length;
            const completedTasks = tasks.filter(task => task.status === 'done').length;
            const completionRate = tasks.length > 0 ? Math.round((completedTasks / tasks.length) * 100) : 0;
            
            // Update overview metrics
            document.getElementById('totalProjects').textContent = totalProjects;
            document.getElementById('activeTasks').textContent = activeTasks;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
            
            // Calculate changes from last month (mock data for now)
            const projectChange = Math.floor(Math.random() * 20) - 10;
            const taskChange = Math.floor(Math.random() * 20) - 10;
            const rateChange = Math.floor(Math.random() * 10) - 5;
            
            document.getElementById('projectChange').textContent = `${projectChange >= 0 ? '+' : ''}${projectChange}% from last month`;
            document.getElementById('taskChange').textContent = `${taskChange >= 0 ? '+' : ''}${taskChange}% from last month`;
            document.getElementById('rateChange').textContent = `${rateChange >= 0 ? '+' : ''}${rateChange}% from last month`;
            
            // Project Progress Chart
            const progressCtx = document.getElementById('projectProgressChart').getContext('2d');
            new Chart(progressCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Completed Tasks',
                        data: [completedTasks, completedTasks * 1.2, completedTasks * 1.4, completedTasks * 1.6, completedTasks * 1.8, completedTasks * 2],
                        borderColor: '#8b5cf6',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Task Distribution Chart
            const distributionCtx = document.getElementById('taskDistributionChart').getContext('2d');
            const taskDistribution = {
                todo: tasks.filter(task => task.status === 'todo').length,
                'in-progress': tasks.filter(task => task.status === 'in-progress').length,
                review: tasks.filter(task => task.status === 'review').length,
                done: completedTasks
            };
            
            new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['To Do', 'In Progress', 'Review', 'Done'],
                    datasets: [{
                        data: [taskDistribution.todo, taskDistribution['in-progress'], taskDistribution.review, taskDistribution.done],
                        backgroundColor: [
                            '#8b5cf6',
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Team Performance Table
            const teamPerformanceBody = document.getElementById('teamPerformanceBody');
            const teamMembers = [...new Set(tasks.map(task => task.assignee))].filter(Boolean);
            
            teamMembers.forEach(member => {
                const memberTasks = tasks.filter(task => task.assignee === member);
                const completedMemberTasks = memberTasks.filter(task => task.status === 'done');
                const onTimeTasks = completedMemberTasks.filter(task => {
                    const dueDate = new Date(task.dueDate);
                    const completionDate = new Date(task.completedAt);
                    return completionDate <= dueDate;
                });
                
                const onTimeRate = completedMemberTasks.length > 0 
                    ? Math.round((onTimeTasks.length / completedMemberTasks.length) * 100) 
                    : 0;
                
                const qualityScore = (Math.random() * 0.5 + 4).toFixed(1); // Mock quality score
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 dark:border-gray-700';
                row.innerHTML = `
                    <td class="py-3 px-4">${member}</td>
                    <td class="py-3 px-4">${completedMemberTasks.length}</td>
                    <td class="py-3 px-4">${onTimeRate}%</td>
                    <td class="py-3 px-4">${qualityScore}/5</td>
                `;
                teamPerformanceBody.appendChild(row);
            });
        });
    </script>
</body>
</html> 